---
export interface Props {
  title: string;
  showHeader?: boolean;
}

import "../styles/Layout.css";

const { title, showHeader = true } = Astro.props;
const session = Astro.locals.session;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title>{title}</title>
  </head>
  <body>
    {
      showHeader && session && (
        <header class="main-header" id="mainHeader">
          <div class="header-content">
            <a href="/" class="logo">
              <h1>Minna</h1>
            </a>

            <div class="search-container">
              <form method="GET" action="/search" class="search-form">
                <input
                  type="text"
                  name="q"
                  placeholder="Search users..."
                  class="search-input"
                />
                <button type="submit" class="search-btn">
                  Find
                </button>
              </form>
            </div>

            <nav class="header-nav">
              <a href="/dashboard" class="nav-link">
                Dashboard
              </a>
              <a href="/profile" class="nav-link">
                My Profile
              </a>
            </nav>
          </div>
        </header>
      )
    }

    <main class={!showHeader ? "full-height" : ""}>
      <slot />
    </main>

    <script>
      let lastScrollY = window.scrollY;
      const header = document.getElementById("mainHeader");
      let ticking = false;

      function updateHeader() {
        const currentScrollY = window.scrollY;

        if (currentScrollY > lastScrollY && currentScrollY > 100) {
          header?.classList.add("header-hidden");
        } else {
          header?.classList.remove("header-hidden");
        }

        lastScrollY = currentScrollY;
        ticking = false;
      }

      function onScroll() {
        if (!ticking) {
          requestAnimationFrame(updateHeader);
          ticking = true;
        }
      }

      window.addEventListener("scroll", onScroll);

      document.addEventListener("mousemove", (e) => {
        if (e.clientY < 100 && header?.classList.contains("header-hidden")) {
          header.classList.remove("header-hidden");
        }
      });
    </script>
  </body>
</html>
