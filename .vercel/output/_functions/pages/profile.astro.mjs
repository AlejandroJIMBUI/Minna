import { e as createComponent, f as createAstro, k as renderComponent, r as renderTemplate, h as addAttribute, m as maybeRenderHead } from '../chunks/astro/server_Crelv-dB.mjs';
import { $ as $$Layout } from '../chunks/Layout_CnnVFTuW.mjs';
import { s as supabase } from '../chunks/supabase_LGgGHRHq.mjs';
/* empty css                                   */
export { renderers } from '../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(cooked.slice()) }));
var _a;
const $$Astro = createAstro();
const prerender = false;
const $$Profile = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Profile;
  const session = Astro2.locals.session;
  const user = Astro2.locals.user;
  if (!session || !user) {
    return Astro2.redirect("/login");
  }
  const { data: profile } = await supabase.from("profiles").select("*").eq("id", user.id).single();
  const { data: userPosts } = await supabase.from("posts").select("*").eq("user_id", user.id).order("created_at", { ascending: false });
  const error = Astro2.url.searchParams.get("error");
  const message = Astro2.url.searchParams.get("message");
  return renderTemplate`${renderComponent($$result, "Layout", $$Layout, { "title": "Mi Perfil", "data-astro-cid-wwes6yjo": true }, { "default": async ($$result2) => renderTemplate(_a || (_a = __template([" ", '<div class="profile-page" data-astro-cid-wwes6yjo> <main class="profile-main" data-astro-cid-wwes6yjo> <div class="profile-card" data-astro-cid-wwes6yjo> <div class="profile-header-section" data-astro-cid-wwes6yjo> <div class="avatar-section" data-astro-cid-wwes6yjo> <img', ' alt="Avatar" class="profile-avatar" id="avatarPreview" data-astro-cid-wwes6yjo> </div> <div class="profile-info" data-astro-cid-wwes6yjo> <h1 data-astro-cid-wwes6yjo>@', '</h1> <p class="full-name" data-astro-cid-wwes6yjo>', '</p> <div class="profile-actions" data-astro-cid-wwes6yjo> <button class="edit-profile-btn" onclick="toggleEditForm()" data-astro-cid-wwes6yjo>\nEditar Perfil\n</button> <form method="POST" action="/api/auth/logout" class="logout-form" data-astro-cid-wwes6yjo> <button type="submit" class="logout-btn" data-astro-cid-wwes6yjo>Cerrar Sesi\xF3n</button> </form> </div> </div> </div> ', ' <div class="profile-stats" data-astro-cid-wwes6yjo> <span class="stat" data-astro-cid-wwes6yjo> <strong data-astro-cid-wwes6yjo>', '</strong> publicaciones\n</span> <span class="stat" data-astro-cid-wwes6yjo>\nMiembro desde ', ' </span> </div> <!-- Formulario de edici\xF3n (oculto por defecto) --> <form method="POST" action="/api/profile/update" class="profile-form" id="editForm" style="display: none;" data-astro-cid-wwes6yjo> ', " ", ' <!-- Secci\xF3n de avatar SOLO visible en modo edici\xF3n --> <div class="form-group" data-astro-cid-wwes6yjo> <label data-astro-cid-wwes6yjo>Foto de perfil</label> <div class="avatar-edit-section" data-astro-cid-wwes6yjo> <img', ' alt="Avatar" class="profile-avatar-edit" id="avatarPreviewEdit" data-astro-cid-wwes6yjo> <div class="avatar-upload-edit" data-astro-cid-wwes6yjo> <div class="avatar-upload-form" data-astro-cid-wwes6yjo> <label for="avatarInput" class="avatar-upload-label" data-astro-cid-wwes6yjo>\nCambiar foto\n</label> <input type="file" id="avatarInput" accept="image/*" style="display: none;" data-astro-cid-wwes6yjo> <div class="upload-info" id="uploadInfo" data-astro-cid-wwes6yjo>\nM\xE1x. 1MB - JPG, PNG, GIF\n</div> <!-- Bot\xF3n para eliminar foto --> ', ' </div> </div> </div> </div> <div class="form-group" data-astro-cid-wwes6yjo> <label for="username" data-astro-cid-wwes6yjo>Nombre de usuario</label> <input type="text" id="username" name="username"', ' required placeholder="tu_usuario" data-astro-cid-wwes6yjo> </div> <div class="form-group" data-astro-cid-wwes6yjo> <label for="fullName" data-astro-cid-wwes6yjo>Nombre completo</label> <input type="text" id="fullName" name="fullName"', ' required placeholder="Tu nombre completo" data-astro-cid-wwes6yjo> </div> <div class="form-group" data-astro-cid-wwes6yjo> <label for="bio" data-astro-cid-wwes6yjo>Biograf\xEDa</label> <textarea id="bio" name="bio" placeholder="Cu\xE9ntanos sobre ti..." rows="4" data-astro-cid-wwes6yjo>', '</textarea> </div> <div class="form-actions" data-astro-cid-wwes6yjo> <button type="button" class="cancel-btn" onclick="toggleEditForm()" data-astro-cid-wwes6yjo>\nCancelar\n</button> <button type="submit" class="save-btn" data-astro-cid-wwes6yjo>Guardar Cambios</button> </div> </form> </div> <div class="user-posts" data-astro-cid-wwes6yjo> <h2 data-astro-cid-wwes6yjo>Mis Publicaciones (', ")</h2> ", ' </div> </main> </div> <script>\n    function toggleEditForm() {\n      const form = document.getElementById("editForm");\n      if (form) {\n        const isHidden = form.style.display === "none";\n        form.style.display = isHidden ? "block" : "none";\n\n        // Cambiar el texto del bot\xF3n\n        const editButton = document.querySelector(".edit-profile-btn");\n        if (editButton) {\n          editButton.textContent = isHidden\n            ? "Cancelar Edici\xF3n"\n            : "Editar Perfil";\n        }\n      }\n    }\n\n    // Funci\xF3n para eliminar avatar\n    async function deleteAvatar() {\n      const avatarPreview = document.getElementById("avatarPreview");\n      const avatarPreviewEdit = document.getElementById("avatarPreviewEdit");\n      const uploadInfo = document.getElementById("uploadInfo");\n\n      if (\n        !confirm("\xBFEst\xE1s seguro de que quieres eliminar tu foto de perfil?")\n      ) {\n        return;\n      }\n\n      try {\n        uploadInfo.textContent = "Eliminando...";\n        uploadInfo.style.color = "#5f6ee7";\n\n        const response = await fetch("/api/profile/delete-avatar", {\n          method: "POST",\n          headers: {\n            "Content-Type": "application/json",\n          },\n        });\n\n        const result = await response.json();\n\n        if (!response.ok) {\n          throw new Error(result.error);\n        }\n\n        // Forzar recarga de la p\xE1gina para asegurar que los cambios se reflejen\n        setTimeout(() => {\n          window.location.reload();\n        }, 1000);\n      } catch (error) {\n        console.error("Error eliminando avatar:", error);\n        uploadInfo.textContent = "Error: " + error.message;\n        uploadInfo.style.color = "#ff4500";\n      }\n    }\n\n    // Upload de avatar usando API endpoint\n    document.addEventListener("DOMContentLoaded", function () {\n      const avatarInput = document.getElementById("avatarInput");\n      const avatarPreview = document.getElementById("avatarPreview");\n      const avatarPreviewEdit = document.getElementById("avatarPreviewEdit");\n      const uploadInfo = document.getElementById("uploadInfo");\n\n      avatarInput.addEventListener("change", async function (event) {\n        const file = event.target.files[0];\n\n        if (!file) return;\n\n        // Validar tama\xF1o (1MB = 1,048,576 bytes)\n        if (file.size > 1048576) {\n          uploadInfo.textContent = "Error: La imagen debe ser menor a 1MB";\n          uploadInfo.style.color = "#ff4500";\n          return;\n        }\n\n        // Validar tipo de archivo\n        if (!file.type.startsWith("image/")) {\n          uploadInfo.textContent = "Error: Solo se permiten im\xE1genes";\n          uploadInfo.style.color = "#ff4500";\n          return;\n        }\n\n        try {\n          uploadInfo.textContent = "Subiendo...";\n          uploadInfo.style.color = "#5f6ee7";\n\n          const formData = new FormData();\n          formData.append("avatar", file);\n\n          const response = await fetch("/api/upload-avatar", {\n            method: "POST",\n            body: formData,\n          });\n\n          const result = await response.json();\n\n          if (!response.ok) {\n            throw new Error(result.error);\n          }\n\n          // Forzar recarga de la p\xE1gina para asegurar que los cambios se reflejen\n          setTimeout(() => {\n            window.location.reload();\n          }, 1000);\n        } catch (error) {\n          console.error("Error subiendo avatar:", error);\n          uploadInfo.textContent = "Error: " + error.message;\n          uploadInfo.style.color = "#ff4500";\n        }\n      });\n    });\n  <\/script> '])), maybeRenderHead(), addAttribute(profile?.avatar_url || "/default-avatar.jpg", "src"), profile?.username, profile?.full_name, profile?.bio && renderTemplate`<div class="bio-section" data-astro-cid-wwes6yjo> <h3 data-astro-cid-wwes6yjo>Biografía</h3> <p class="bio-text" data-astro-cid-wwes6yjo>${profile.bio}</p> </div>`, userPosts?.length || 0, new Date(profile?.created_at || /* @__PURE__ */ new Date()).getFullYear(), error && renderTemplate`<div class="error-message" data-astro-cid-wwes6yjo>${decodeURIComponent(error)}</div>`, message && renderTemplate`<div class="success-message" data-astro-cid-wwes6yjo>${decodeURIComponent(message)}</div>`, addAttribute(profile?.avatar_url || "/default-avatar.jpg", "src"), profile?.avatar_url && renderTemplate`<button type="button" class="delete-avatar-btn" onclick="deleteAvatar()" data-astro-cid-wwes6yjo>
Eliminar foto
</button>`, addAttribute(profile?.username || "", "value"), addAttribute(profile?.full_name || "", "value"), profile?.bio || "", userPosts?.length || 0, userPosts && userPosts.length > 0 ? renderTemplate`<div class="posts-list" data-astro-cid-wwes6yjo> ${userPosts.map((post) => renderTemplate`<article class="post-card" data-astro-cid-wwes6yjo> <div class="post-header" data-astro-cid-wwes6yjo> <span class="post-date" data-astro-cid-wwes6yjo> ${new Date(post.created_at).toLocaleDateString()} </span> </div> <h3 class="post-title" data-astro-cid-wwes6yjo>${post.title}</h3> <p class="post-content" data-astro-cid-wwes6yjo>${post.content}</p> </article>`)} </div>` : renderTemplate`<div class="no-posts" data-astro-cid-wwes6yjo> <p data-astro-cid-wwes6yjo>Aún no has creado publicaciones.</p> <a href="/create-post" class="create-post-link" data-astro-cid-wwes6yjo>
Crear primera publicación
</a> </div>`) })} `;
}, "C:/Users/buitr/OneDrive/Documents/Archives/Projects/Minna/src/pages/profile.astro", void 0);

const $$file = "C:/Users/buitr/OneDrive/Documents/Archives/Projects/Minna/src/pages/profile.astro";
const $$url = "/profile";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$Profile,
  file: $$file,
  prerender,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
